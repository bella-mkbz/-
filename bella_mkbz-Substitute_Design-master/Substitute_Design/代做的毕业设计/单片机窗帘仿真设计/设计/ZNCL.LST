C51 COMPILER V9.56.0.0   ZNCL                                                              11/28/2017 18:04:24 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE ZNCL
OBJECT MODULE PLACED IN ZNCL.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ZNCL.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include<reg51.h>
   2          #include<string.h>
   3          #include<stdio.h>
   4          #define uchar unsigned char
   5          #define uint unsigned int
   6          #define LCD1602_dat P0           //1602 ˝æ›ø⁄
   7          
   8          
   9          sbit LCD1602_rs=P2^5;          //1602 I/O ∂®“Â
  10          sbit LCD1602_rw=P2^6;          //1602 I/O ∂®“Â
  11          sbit LCD1602_e=P2^7;
  12          
  13          sbit SCLK=P3^4;                         //DS1302 ±÷”
  14          sbit SDA=P3^5;                        //DS1302 ˝æ›
  15          sbit RST=P3^6;                        //DS1302∆¨—°
  16          
  17          sbit key_1=P1^0;            //…Ë÷√∞¥º¸
  18          sbit key_2=P1^1;            //
  19          sbit key_3=P1^2;            //
  20          sbit key_4=P1^3;            //«–ªªƒ£ Ω∞¥º¸
  21                               
  22          sbit IDR=P1^4;              //∂®“Âπ‚√ÙµÁ◊ËΩ”ø⁄
  23          
  24          
  25          uchar zz[]=          //’˝◊™ ˝æ›
  26          {
  27            0x01,0x03,0x02,0x06,0x04,0x0c,0x08,0x09
  28          };
  29          
  30          
  31          uchar fz[]=          //∑¥◊™ ˝æ›
  32          {
  33            0x09,0x08,0x0c,0x04,0x06,0x02,0x03,0x01
  34          };
  35          
  36          
  37          
  38          
  39          uchar irdate[33];             //¥Ê¥¢Ω” ’µΩµƒ∫ÏÕ‚–≈∫≈
  40          uchar irbyte[4];              //¥Ê¥¢∂‘Ω” ’–≈∫≈¥¶¿Ì∫Ûµƒ ˝æ›
  41          uchar irtime,irflag,bitnum,irdateok;    //∂®“ÂΩ” ’∫ÏÕ‚À˘–Ë“™µƒ±‰¡ø
  42          uint time_s;
  43          uint DJ_dat;
  44          
  45          uint ms;
  46          uchar Time[12];                             //¥Ê¥¢ ±º‰ ˝æ›     
  47          uchar state,loop;
  48          bit s1,open,now_state;
  49          bit Serial_Flag;
  50          
  51          void delay(uint T)                 //—” ±≥Ã–Ú
  52          {
  53   1        while(T--);
  54   1      }
  55          
C51 COMPILER V9.56.0.0   ZNCL                                                              11/28/2017 18:04:24 PAGE 2   

  56          //∂® ±–¥ ˝æ›
  57          void DS1302WriteByte(uchar dat)
  58          {
  59   1        uchar i;
  60   1        SCLK=0;          // ≥ı º ±÷”œﬂ÷√Œ™ 0 0 0 0
  61   1        delay(20);
  62   1        for(i=0;i<8;i++)       // ø™ º¥´ ‰ 8 8 8 8  ∏ˆ◊÷Ω⁄µƒ ˝æ›
  63   1        {
  64   2          SDA=dat&0x01;      // »°◊ÓµÕŒª£¨◊¢“‚  2 DS1302 µƒ ˝æ›∫Õµÿ÷∑∂º «¥”◊ÓµÕŒªø™ º¥´ ‰µƒ
  65   2          delay(20);
  66   2          SCLK=1;          //  ±÷”œﬂ¿≠∏ﬂ£¨÷∆‘Ï…œ…˝—ÿ£¨ SDA  µƒ ˝æ›±ª¥´ ‰
  67   2          delay(20);
  68   2          SCLK=0;          //  ±÷”œﬂ¿≠µÕ£¨Œ™œ¬“ª∏ˆ…œ…˝—ÿ◊ˆ◊º±∏
  69   2          dat>>=1;         //  ˝æ›”““∆“ªŒª£¨◊º±∏¥´ ‰œ¬“ªŒª ˝æ›
  70   2        }
  71   1      }
  72             //∂® ±∂¡ ˝æ›
  73          uchar DS1302ReadByte()
  74          {
  75   1        uchar i,dat;
  76   1        delay(20);
  77   1        for(i=0;i<8;i++)
  78   1        {
  79   2          dat>>=1;         // “™∑µªÿµƒ ˝æ›◊Û“∆“ªŒª
  80   2          if(SDA==1)         // µ± ˝æ›œﬂŒ™∏ﬂ ±£¨÷§√˜∏√Œª ˝æ›Œ™ 1 1 1 1
  81   2          dat|=0x80;       // “™¥´ ‰ ˝æ›µƒµ±«∞÷µ÷√Œ™ , 1, »Ù≤ª «, , , , ‘ÚŒ™ 0 0 0 0
  82   2          SCLK=1;                 //¿≠∏ﬂ ±÷”œﬂ
  83   2          delay(20);
  84   2          SCLK=0;          // ÷∆‘Ïœ¬Ωµ—ÿ
  85   2          delay(20);
  86   2        }
  87   1        return dat;        // ∑µªÿ∂¡»°≥ˆµƒ ˝æ›
  88   1      }
  89          
  90          
  91          uchar DS1302Read(uchar cmd)
  92          {
  93   1        uchar dat;
  94   1        RST=0;          // ≥ı º  CE  œﬂ÷√Œ™ 0 0 0 0
  95   1        SCLK=0;          // ≥ı º ±÷”œﬂ÷√Œ™ 0 0 0 0
  96   1        RST=1;          // ≥ı º  CE  ÷√Œ™ 1 1 1 1 £¨¥´ ‰ø™ º
  97   1        DS1302WriteByte(cmd);    // ¥´ ‰√¸¡Ó◊÷£¨“™∂¡»°µƒ ±º‰
  98   1        dat=DS1302ReadByte();     // ∂¡»°“™µ√µΩµƒ ±º‰
  99   1        SCLK=1;          //  ±÷”œﬂ¿≠∏ﬂ
 100   1        RST=0;           // ∂¡»°Ω· ¯£¨ CE ÷√Œ™ 0 0 0 0 £¨Ω· ¯ ˝æ›µƒ¥´ ‰
 101   1        return dat;         // ∑µªÿµ√µΩµƒ ±º‰
 102   1      }
 103          
 104          void DS1302Write(uchar cmd, uchar dat)
 105          {
 106   1        RST=0;           // ≥ı º  CE  œﬂ÷√Œ™ 0 0 0 0
 107   1        SCLK=0;          // ≥ı º ±÷”œﬂ÷√Œ™ 0 0 0 0
 108   1        RST=1;             // ≥ı º  CE  ÷√Œ™ 1 1 1 1 £¨¥´ ‰ø™ º
 109   1        DS1302WriteByte(cmd); 
 110   1        dat=(dat/10)*16+dat%10;
 111   1        DS1302WriteByte(dat);     // –¥»Î“™–ﬁ∏ƒµƒ ±º‰
 112   1        SCLK=1;          //  ±÷”œﬂ¿≠∏ﬂ
 113   1        RST=0;           // ∂¡»°Ω· ¯£¨ CE  ÷√Œ™ 0 0 0 0 £¨Ω· ¯ ˝æ›µƒ¥´ ‰
 114   1      }
 115          
 116          
 117          void Init_DS1302(void)
C51 COMPILER V9.56.0.0   ZNCL                                                              11/28/2017 18:04:24 PAGE 3   

 118          {
 119   1        if (DS1302Read(0xc1)!=3)
 120   1        {
 121   2          DS1302Write(0x8e,0x00);     // –¥±£ª§πÿ
 122   2          DS1302Write(0xc0,3);
 123   2          DS1302Write(0x80,0); //√Î      // ≥ı º√Î÷µŒ™ 0 
 124   2          DS1302Write(0x82,18);//∑÷      // ≥ı º∑÷÷”÷µŒ™  0
 125   2          DS1302Write(0x84,6);// ±     // ≥ı ºŒ™ 24  Ω –° ±ƒ£ Ω  ≥ı º ±º‰Œ™ 0µ„
 126   2          DS1302Write(0x88,3);
 127   2          DS1302Write(0x8c,15);
 128   2          DS1302Write(0x8a,3);
 129   2          DS1302Write(0x90,0x01);      // ≥‰µÁ
 130   2          DS1302Write(0x8e,0x80);
 131   2        }else
 132   1        {   
 133   2          DS1302Write(0x8e,0x00);     // –¥±£ª§πÿ
 134   2          DS1302Write(0x90,0x01);      // ≥‰µÁ
 135   2          DS1302Write(0x8e,0x80); 
 136   2        }
 137   1      }
 138          
 139          void read_time1()            // µ ±∂¡»°DS1302÷–µƒ ±º‰ ˝æ›
 140          {
 141   1        uchar i,j;
 142   1        for (j=0;j<7;j++)         //“¿¥Œ∂¡≥ˆ√Î.∑÷.–° ± ¥ÊµΩTime ˝◊È
 143   1        {
 144   2          i=DS1302Read(0x81+j*2);
 145   2          i=(i/16)*10+i%16;
 146   2          Time[j]=i;
 147   2        }
 148   1        
 149   1        for (j=0;j<5;j++)
 150   1        {
 151   2          i=DS1302Read(0xc3+j*2);      //∂¡¥ÊµΩDs1302æ≤Ã¨RAMµƒ ˝æ›
 152   2          i=(i/16)*10+i%16;
 153   2          Time[7+j]=i;
 154   2        }
 155   1        if(Time[7]>23||Time[9]>23||Time[8]>59||Time[10]>59)  //»Ù∂¡≥ˆµƒ ˝æ›≤ª∫œ≥£¿Ì£¨≥ı º∏≥÷µ
 156   1        {
 157   2          Time[7]=6;                       //¥Ê¥¢µƒ «∂® ± ±º‰œ¬œﬁ–° ±
 158   2          Time[8]=30;            //¥Ê¥¢µƒ «∂® ± ±º‰œ¬œﬁ∑÷
 159   2          Time[9]=8;             //¥Ê¥¢µƒ «∂® ± ±º‰…œœﬁ–° ±
 160   2          Time[10]=0;            //¥Ê¥¢µƒ «∂® ± ±º‰…œœﬁ∑÷
 161   2        }
 162   1        if(Time[11]>2)Time[11]=0;      //¥Ê¥¢µƒ «¥¶”⁄ƒ«÷÷ƒ£ Ω£®0 ÷∂Øƒ£ Ω   1◊‘∂Øƒ£ Ω      2∂® ±ƒ£ Ω£©
 163   1      }
 164          
 165          void read_time()             //∂¡»°DS1302 µƒµ±«∞ ±º‰
 166          {
 167   1        uchar i;
 168   1      
 169   1        i=DS1302Read(0x81+0*2);
 170   1        i=(i/16)*10+i%16;
 171   1        Time[0]=i;
 172   1        
 173   1      /*  if(Time[0]==0)
 174   1        {
 175   1          i=DS1302Read(0x81+1*2);     //0x83∂¡≥ˆµƒ «∑÷
 176   1          i=(i/16)*10+i%16;       //∂¡≥ˆµƒ « Æ¡˘Ω¯÷∆BCD£¨◊™ªªŒ™ ÆΩ¯÷∆
 177   1          Time[1]=i;            //¥Ê¥¢
 178   1          if(Time[1]==0)
 179   1          {
C51 COMPILER V9.56.0.0   ZNCL                                                              11/28/2017 18:04:24 PAGE 4   

 180   1            i=DS1302Read(0x81+2*2);
 181   1            i=(i/16)*10+i%16;
 182   1            Time[2]=i;
 183   1            if(Time[2]==0)
 184   1            {
 185   1              i=DS1302Read(0x81+3*2);
 186   1              i=(i/16)*10+i%16;
 187   1              Time[3]=i;
 188   1              i=DS1302Read(0x81+5*2);
 189   1              i=(i/16)*10+i%16;
 190   1              Time[5]=i;
 191   1              if(Time[3]==1)
 192   1              {
 193   1                i=DS1302Read(0x81+4*2);
 194   1                i=(i/16)*10+i%16;
 195   1                Time[4]=i;
 196   1                if(Time[4]==1)
 197   1                {
 198   1                  i=DS1302Read(0x81+6*2);
 199   1                  i=(i/16)*10+i%16;
 200   1                  Time[6]=i;
 201   1                }
 202   1              } 
 203   1            } 
 204   1          } 
 205   1        } */  
 206   1      }
 207             
 208          void write_DS1302(void)           //  Ω´…Ë÷√∫√µƒ ±º‰°¢∑¢ÀÕµΩDS1302   ƒ⁄
 209          {                   
 210   1        DS1302Write(0x8e,0x00);         //»•±£ª§
 211   1        DS1302Write(0xc4,Time[8]);    
 212   1        DS1302Write(0xc6,Time[9]);
 213   1        DS1302Write(0xc8,Time[10]);
 214   1        DS1302Write(0x90,0x01);          
 215   1        DS1302Write(0x8e,0x80);
 216   1      }
 217          
 218          void write_SYS_mode(void)           //  Ω´…Ë÷√∫√µƒ ±º‰°¢ ∑¢ÀÕµΩDS1302   ƒ⁄
 219          {                   
 220   1        DS1302Write(0x8e,0x00);
 221   1        DS1302Write(0xcA,Time[11]);
 222   1      
 223   1        DS1302Write(0x90,0x01);          
 224   1        DS1302Write(0x8e,0x80);
 225   1      }
 226          
 227          
 228          
 229          void LCD1602_write(uchar order,dat)         //1602 “ª∏ˆ◊÷Ω⁄  ¥¶¿Ì
 230          {
 231   1          LCD1602_e=0;
 232   1          LCD1602_rs=order;
 233   1          LCD1602_dat=dat;
 234   1          LCD1602_rw=0;
 235   1          LCD1602_e=1;
 236   1          delay(1);
 237   1          LCD1602_e=0;                                                     
 238   1      }
 239          
 240          void LCD1602_writebyte(uchar *prointer)          //1602 ◊÷∑˚¥Æ    ¥¶¿Ì
 241          {
C51 COMPILER V9.56.0.0   ZNCL                                                              11/28/2017 18:04:24 PAGE 5   

 242   1          while(*prointer!='\0')
 243   1          {
 244   2              LCD1602_write(1,*prointer);
 245   2              prointer++;
 246   2          }
 247   1      }
 248          
 249          void LCD1602_cls()                   //1602 ≥ı ºªØ
 250          {
 251   1        LCD1602_write(0,0x01);     //1602 «Â∆¡ ÷∏¡Ó
 252   1        delay(1500);
 253   1        LCD1602_write(0,0x38);     // π¶ƒ‹…Ë÷√ 8Œª°¢5*7µ„’Û
 254   1        delay(1500);
 255   1        LCD1602_write(0,0x0c);     //…Ë÷√ π‚±Í   ≤ªœ‘ æø™πÿ°¢≤ªœ‘ æπ‚±Í°¢◊÷∑˚≤ª…¡À∏
 256   1        LCD1602_write(0,0x06);
 257   1        LCD1602_write(0,0xd0);
 258   1        delay(1500);
 259   1      }
 260          
 261          void show()
 262          {
 263   1        LCD1602_write(0,0x80);           //‘⁄1602µ⁄“ª––œ‘ æ
 264   1        if(state==1&&s1==1)            //…¡À∏¥¶¿Ì
 265   1        {
 266   2          LCD1602_writebyte("    ");
 267   2        }else
 268   1      
 269   1        LCD1602_writebyte(" ");
 270   1        if(state==4&&s1==1)           //œ‘ æ–° ±
 271   1        {
 272   2          LCD1602_writebyte("  ");
 273   2        }else
 274   1        {
 275   2          LCD1602_write(1,0x30+Time[2]/10%10);
 276   2          LCD1602_write(1,0x30+Time[2]%10);
 277   2        }
 278   1        if(state==0&&s1==1)                      //√∞∫≈◊ˆ–° ˝¥¶¿Ì£¨√ø“ª√Î…¡À∏“ª¥Œ
 279   1        {
 280   2          LCD1602_writebyte(" ");
 281   2        }else
 282   1        {
 283   2          LCD1602_writebyte(":");
 284   2        }
 285   1        if(state==5&&s1==1)           //œ‘ æ∑÷
 286   1        {
 287   2          LCD1602_writebyte("  ");
 288   2        }else
 289   1        {
 290   2          LCD1602_write(1,0x30+Time[1]/10%10);
 291   2          LCD1602_write(1,0x30+Time[1]%10);
 292   2        }
 293   1        
 294   1      
 295   1        LCD1602_write(0,0xc0);            //1602µ⁄∂˛––£¨c0=80+40
 296   1        if(Time[11]==2&&state>5)
 297   1        {
 298   2          LCD1602_writebyte("O:");        //∂® ±ƒ£ Ωœ¬µƒ£¨∂® ± ±º‰œ¬œﬁ
 299   2          if(state==6&&s1==1)           //…¡À∏¥¶¿Ì
 300   2          {
 301   3            LCD1602_writebyte("  ");
 302   3          }else
 303   2          {
C51 COMPILER V9.56.0.0   ZNCL                                                              11/28/2017 18:04:24 PAGE 6   

 304   3            LCD1602_write(1,0x30+Time[7]/10%10);//œ‘ æ∂® ± ±º‰œ¬œﬁ µƒ–° ±
 305   3            LCD1602_write(1,0x30+Time[7]%10);
 306   3          }
 307   2          LCD1602_writebyte(":");
 308   2          if(state==7&&s1==1)
 309   2          {
 310   3            LCD1602_writebyte("  ");
 311   3          }else
 312   2          {
 313   3            LCD1602_write(1,0x30+Time[8]/10%10); //œ‘ æ∂® ± ±º‰œ¬œﬁ µƒ∑÷÷”
 314   3            LCD1602_write(1,0x30+Time[8]%10);
 315   3          }
 316   2      
 317   2          LCD1602_writebyte("  C:");         //œ‘ æ ±º‰…œœﬁ
 318   2          if(state==8&&s1==1)
 319   2          {
 320   3            LCD1602_writebyte("  ");
 321   3          }else
 322   2          {
 323   3            LCD1602_write(1,0x30+Time[9]/10%10);  //–° ±
 324   3            LCD1602_write(1,0x30+Time[9]%10);
 325   3          }
 326   2          LCD1602_writebyte(":");
 327   2          if(state==9&&s1==1)
 328   2          {
 329   3            LCD1602_writebyte("  ");
 330   3          }else
 331   2          {
 332   3            LCD1602_write(1,0x30+Time[10]/10%10);  //∑÷÷”
 333   3            LCD1602_write(1,0x30+Time[10]%10);
 334   3          }
 335   2        }else
 336   1        {
 337   2          switch(Time[11])
 338   2          {
 339   3            case 0:
 340   3              LCD1602_writebyte(" Manual");   // ÷∂Ø
 341   3            break;
 342   3        
 343   3            case 1:
 344   3              LCD1602_writebyte(" Auto  ");   //◊‘∂Ø
 345   3            break;
 346   3        
 347   3            case 2:
 348   3              LCD1602_writebyte(" Timing");   //∂® ±
 349   3            break;
 350   3          }                       //◊¥Ã¨
 351   2          LCD1602_writebyte("  WIN:");
 352   2          if(open==0)
 353   2          {
 354   3            LCD1602_writebyte("OFF");
 355   3          }else
 356   2          {
 357   3            LCD1602_writebyte(" ON"); 
 358   3          }
 359   2        } 
 360   1      }
 361          
 362          
 363          void qing()                               //«Âø’Ω” ’µΩµƒ∫ÏÕ‚ ˝æ›
 364          {
 365   1        uint i;
C51 COMPILER V9.56.0.0   ZNCL                                                              11/28/2017 18:04:24 PAGE 7   

 366   1        for(i=0;i<33;i++)
 367   1        {
 368   2          irdate[i]=0;
 369   2        }
 370   1      }
 371          
 372          
 373          void deal_with()              //∫ÏÕ‚ ˝æ›¥¶¿Ì£¨∫ÏÕ‚ ˝æ› « Æ¡˘Ω¯÷∆
 374          {
 375   1        uchar i,j,k,temp;
 376   1        k=1;                  //K=1,“ÚŒ™¥Ê‘⁄irdate ˝◊È¿ÔΩ” ’µΩµƒµ⁄“ªŒª « “˝µº¬Î£¨≤ª–Ë“™
 377   1        for(j=0;j<4;j++)            //“ª÷°∫ÏÕ‚ ˝æ›∞¸¿®£¨“ªŒª“˝µº¬Î£¨ÀƒŒª”√ªß¬Î
 378   1        {
 379   2          for(i=0;i<8;i++)          //—≠ª∑8¥Œ£¨Ã·≥ˆ¿¥“ªŒª ˝æ›
 380   2          { 
 381   3            temp=temp>>1;
 382   3            if(irdate[k]>7)          //Õ®π˝ºº ı ÷≤·£¨ø…÷™£¨Ω” ‹µΩµƒ ˝æ›‘⁄4◊Û”“£¨ «0£¨    8◊Û”“ «1£¨»°÷–º‰÷µ£¨¥Û”⁄∆ﬂ£¨º¥
             -Œ™1
 383   3            {
 384   4              temp=temp|0x80; 
 385   4            }
 386   3            k++;
 387   3          }
 388   2          irbyte[j]=temp;             //∂¡≥ˆ¿¥µƒ ˝æ›¥Ê¥¢  £¨ ˝æ›µƒ∏Ò Ω «16Ω¯÷∆
 389   2        }
 390   1      }
 391          
 392          void key()                    //∞¥º¸ºÏ≤‚
 393          {
 394   1        if(!key_4||irbyte[2]==0x08)         //»Áπ˚∞¥º¸KEY4”–∞¥œ¬£¨ªÚ’ﬂ∫ÏÕ‚Ω” ’µƒ–≈∫≈0x08,ƒ«√¥æÕ÷¥––’‚∏ˆ”Ôæ‰
 395   1        {
 396   2          delay(1000);
 397   2          if(!key_4||irbyte[2]==0x08)
 398   2          {
 399   3            while(!key_4||irbyte[2]==0x08)
 400   3            {
 401   4              qing();              //«Âø’¥Ê¥¢∫ÏÕ‚µƒ ˝◊È
 402   4              deal_with();           //∫ÏÕ‚ ˝æ›¥¶¿Ì£¨∫ÏÕ‚ ˝æ› « Æ¡˘Ω¯÷∆
 403   4            }
 404   3            Time[11]=(Time[11]+1)%3;       //ƒ£ Ω±Í÷æŒªº”“ª  
 405   3            state=0;               //«Âø’—°‘Ò±Í÷æŒª
 406   3            write_SYS_mode();          //Ω´…Ë÷√∫√µƒ ±º‰∑¢ÀÕµΩDS1302   ƒ⁄
 407   3          }
 408   2        }
 409   1      
 410   1        if(!key_1||irbyte[2]==0x0c)         //…Ë÷√∞¥ÊI∞¥œ¬£¨ªÚ’ﬂºtÕ‚Ω” ’µΩµƒ ˝æ› «0x0cæÕ÷¥––’‚Ãı”Ôæ‰
 411   1        {                     
 412   2          delay(1000);
 413   2          if(!key_1||irbyte[2]==0x0c)
 414   2          {
 415   3            while(!key_1||irbyte[2]==0x0c)
 416   3            {
 417   4              qing();
 418   4              deal_with();
 419   4            }
 420   3            if(Time[11]==2)
 421   3            {
 422   4              state=(state+1)%10; 
 423   4            }else
 424   3            {
 425   4              state=(state+1)%6;
 426   4            }
C51 COMPILER V9.56.0.0   ZNCL                                                              11/28/2017 18:04:24 PAGE 8   

 427   3      
 428   3            if(state==0)
 429   3            {
 430   4              write_DS1302();
 431   4            }
 432   3          }
 433   2        }
 434   1        
 435   1        if(!key_2||irbyte[2]==0x18)          
 436   1        {
 437   2          delay(1000);
 438   2          if(!key_2||irbyte[2]==0x18)
 439   2          {
 440   3            while(!key_2||irbyte[2]==0x18)
 441   3            {
 442   4              if(irdateok==1)
 443   4              {
 444   5                irdateok=0;
 445   5                deal_with();
 446   5              } 
 447   4            }
 448   3            switch(state)         //key1°¢key2‘⁄ƒ£ Ω0£® ÷∂Ø£©œ¬£¨µ±state=0¥Úø™¥∞¡±
 449   3            {
 450   4              case 0:
 451   4                if(Time[11]==0)       //key1/key2‘⁄ƒ£ Ω0£® ÷∂Ø£©œ¬£¨µ±state=0¥Úø™ªÚπÿ±’
 452   4                {
 453   5                  now_state=1;
 454   5                } 
 455   4              break;
 456   4      
 457   4          
 458   4              case 4:
 459   4                Time[2]=(Time[2]+1)%24;          //state=4 ±£¨∂‘–° ±Ω¯––º”“ª¥¶¿Ì
 460   4              break;
 461   4                                                    
 462   4              case 5:
 463   4                Time[1]=(Time[1]+1)%60;           //state=5 ±£¨∂‘∑÷÷”Ω¯––º”“ª¥¶¿Ì
 464   4              break;
 465   4                  case 6: 
 466   4                Time[7]=(Time[7]+1)%24;         //state=6 ±£¨∂‘∂® ±ƒ£ Ωœ¬µƒœ¬œﬁ–° ±Ω¯––º”“ª¥¶¿Ì
 467   4              break;
 468   4      
 469   4              case 7:
 470   4                Time[8]=(Time[8]+1)%60;         //state=7 ±£¨∂‘∂® ±ƒ£ Ωœ¬µƒœ¬œﬁ∑÷÷”Ω¯––¥¶¿Ì
 471   4              break;
 472   4      
 473   4              case 8:
 474   4                Time[9]=(Time[9]+1)%24;          //state=8 ±£¨∂‘∂® ±ƒ£ Ωœ¬µƒ…œœﬁ–° ±Ω¯––º”“ª¥¶¿Ì
 475   4              break;
 476   4      
 477   4              case 9:
 478   4                Time[10]=(Time[10]+1)%60;        //state=9 ±£¨∂‘∂® ±ƒ£ Ωœ¬µƒ…œœﬁ∑÷÷”Ω¯––º”“ª¥¶¿Ì
 479   4              break;
 480   4      
 481   4          
 482   4            }
 483   3          }
 484   2        }
 485   1        if(!key_3||irbyte[2]==0x5e)               //ºı¥¶¿Ì£¨ΩÈ…‹Õ¨…œ
 486   1        {
 487   2          delay(1000);
 488   2          if(!key_3||irbyte[2]==0x5e)
C51 COMPILER V9.56.0.0   ZNCL                                                              11/28/2017 18:04:24 PAGE 9   

 489   2          {
 490   3            while(!key_3||irbyte[2]==0x5e)
 491   3            {
 492   4              if(irdateok==1)
 493   4              {
 494   5                irdateok=0;
 495   5                deal_with();
 496   5              }
 497   4            }
 498   3            switch(state)
 499   3            {
 500   4              case 0:
 501   4                if(Time[11]==0)
 502   4                {
 503   5                  now_state=0;
 504   5                }
 505   4              break;
 506   4      
 507   4              
 508   4              case 4:
 509   4                if(Time[2]==0) Time[2]=23;
 510   4                else Time[2]--;
 511   4              break;
 512   4      
 513   4              case 5:
 514   4                if(Time[1]==0) Time[1]=59;
 515   4                else Time[1]--;
 516   4              break;
 517   4            
 518   4      
 519   4              case 6:
 520   4                if(Time[7]==0) Time[7]=23;
 521   4                else Time[7]--;
 522   4              break;
 523   4      
 524   4              case 7:
 525   4              
 526   4                if(Time[8]==0) Time[8]=59;
 527   4                else Time[8]--;
 528   4                
 529   4              break;
 530   4      
 531   4              case 8:
 532   4                if(Time[9]==0) Time[9]=23;
 533   4                else Time[9]--;
 534   4              break;
 535   4      
 536   4              case 9:
 537   4                if(Time[10]==0) Time[10]=59;
 538   4                else Time[10]--;
 539   4              break;
 540   4      
 541   4            }
 542   3          }
 543   2        }
 544   1          
 545   1      }
 546          
 547          void proc()
 548          {
 549   1        uint xiax,shiji,shangx;          //∂®“Â»˝∏ˆ±‰¡ø£¨xiax «∂® ± ±º‰œ¬œﬁ   shangx∂® ± ±º‰…œœﬁ  shiji µº  ±º‰
 550   1        if(now_state==1)         //…Ë÷√µÁª˙µƒ–˝◊™
C51 COMPILER V9.56.0.0   ZNCL                                                              11/28/2017 18:04:24 PAGE 10  

 551   1        {
 552   2          if(DJ_dat<520)
 553   2          {
 554   3            P2=P2&0xf0|zz[loop];
 555   3            loop=(loop+1)%8;
 556   3            delay(150);
 557   3            if(loop==0) DJ_dat++;
 558   3          
 559   3          }else
 560   2          {
 561   3            P2=P2&0xf0;
 562   3            open=1;
 563   3          }
 564   2        }else
 565   1        {
 566   2          if(DJ_dat>0)
 567   2          {
 568   3            P2=P2&0xf0|fz[loop];
 569   3            loop=(loop+1)%8;
 570   3            delay(150);
 571   3            if(loop==0) DJ_dat--;
 572   3          
 573   3          }else
 574   2          {
 575   3            P2=P2&0xf0;
 576   3            open=0;
 577   3          }
 578   2        }
 579   1        if(Time[11]==1)         //ƒ£ Ω1£®◊‘∂Øƒ£ Ω£©£¨µÁª˙◊™∂Ø…Ë÷√
 580   1        {               
 581   2          if(IDR==0)
 582   2          { 
 583   3            now_state=1;        
 584   3          }else
 585   2          {
 586   3            now_state=0;  
 587   3          }   
 588   2        }
 589   1        
 590   1        if(Time[11]==2)          //ƒ£ Ω2£®∂® ±ƒ£ Ω£©£¨µÁª˙◊™∂Ø…Ë÷√  ’€∫œ≥…∑÷÷”Ω¯––±»Ωœ
 591   1        {
 592   2          xiax=Time[7]*60+Time[8];     //∂® ± ±º‰œ¬œﬁ
 593   2          shangx=Time[9]*60+Time[10];    //∂® ± ±º‰…œœﬁ
 594   2          shiji=Time[2]*60+Time[1];    // µº  ±º‰
 595   2          if(xiax>shangx)          //»Áπ˚∂® ±µƒœ¬œﬁ¥Û”⁄…œœﬁ£¨“ÚŒ™ «24–° ±÷∆ Àµ√˜ «ÕÌº‰µƒ∂® ±
 596   2          {
 597   3            if(shiji>=xiax||shiji<shangx)    // µº  ±º‰¥Û”⁄œ¬œﬁ£¨ªÚ’ﬂ–°”Î…œœﬁ
 598   3            {
 599   4              now_state=1;     //πÿ±’¥∞¡±     
 600   4            }else if(shiji<xiax&&shiji>=shangx)  //‘⁄ ∂® ± ±º‰“‘Õ‚£¨¥Úø™¥∞¡±
 601   3            {
 602   4              now_state=0;  
 603   4            }
 604   3          }else if(shangx>xiax)        //œ¬œﬁ–°”⁄…œœﬁ£¨∞◊ÃÏ∂® ±
 605   2          {
 606   3            if(shiji>=xiax&&shiji<shangx)    //ΩÈ”⁄∂® ± ±º‰÷Æº‰£¨πÿ±’¥∞¡±
 607   3            {
 608   4              now_state=1;              
 609   4            }else if(shiji>=shangx||shiji<xiax)   //≤ª‘⁄∂® ± ±º‰£¨∆Ù∂Ø¥∞¡±
 610   3            {
 611   4              now_state=0;  
 612   4            }
C51 COMPILER V9.56.0.0   ZNCL                                                              11/28/2017 18:04:24 PAGE 11  

 613   3          } 
 614   2        } 
 615   1      }
 616          
 617          void main()
 618          {
 619   1        TMOD=0x21;     //∂® ±∆˜π§◊˜∑Ω Ω…Ë∂®
 620   1        TH1=0x3c;
 621   1        TL1=0xb0;
 622   1        TH0=0xec;   //         
 623   1        TL0=0x77;
 624   1        EA=1;  //ø™÷–∂œ
 625   1        ET0=1;  //‘ –ÌT0÷–∂œ
 626   1        TR0=1;    //∆Ù∂ØT0
 627   1        EX0=1;   //‘ –ÌÕ‚≤ø÷–∂œINTO÷–∂œ ,
 628   1        ET1=1;   //‘ –ÌT1÷–∂œ
 629   1        TR1=1;
 630   1        IT0=1;  //‘ –Ì∂® ±∆˜T0÷–∂œ
 631   1        SCON=0X50;
 632   1        PCON=0X00;
 633   1        ES =1;
 634   1        Init_DS1302();
 635   1        read_time1();
 636   1      //  read_time1();
 637   1        LCD1602_cls();
 638   1        while(1)
 639   1        {
 640   2          if(irdateok==1)
 641   2          {
 642   3            irdateok=0;
 643   3            deal_with();
 644   3            qing();
 645   3          }
 646   2          key();
 647   2          show();
 648   2          if(state==0) read_time();
 649   2        }
 650   1      }
 651          
 652          
 653          
 654          void int0() interrupt 0        //Õ‚≤ø÷–∂œ0£¨”√”⁄ºÏ≤‚∫ÏÕ‚–≈∫≈
 655          {
 656   1        time_s=0;           
 657   1        if(irflag==1)
 658   1        {
 659   2          if(irtime>32)         //ºÏ≤‚∫ÏÕ‚“˝µº¬Î
 660   2          {
 661   3            bitnum=0;
 662   3          }
 663   2          irdate[bitnum]=irtime;
 664   2          irtime=0;
 665   2          bitnum++;
 666   2          if(bitnum==33)           //∫ÏÕ‚–≈∫≈£¨À„…œ“˝µº¬Î“ªπ≤”–33Œª
 667   2        † {
 668¢  3      !@    bhtnum=0+  $ $     //«Â¡„£¨ŒÈœ¬¥ŒÍπS√◊ˆ◊º°∏
$66 " 3            irdqteoc=1;    0     //33Œªä˝æ›¥Ê∞¢ÕÍ±œ£à∫ÏÕ‚Ω” ’…Í±œ1Í÷æ∆õ÷√“ª
 6∑0   3          }
†>71 ( 2        }
 672&  1   "   (eLse
 673 " 1 "!     {
0v64   2         $irvlag=1;
C51 C_MPILER V9.56.1.0 0 ZNCL         0     † 0        8       0       $	                  1!/28/221? 18:∞422$ PAGE 0r  

 675 0 2     (    irtime=2;ä 676   2 0  $  0}
 6770  1!  †  }J!63:(   `   $`M
 679      (    0†"† $!!    $
 680       !$†
 601        " void init_1() i~te“rut 1    //∂® ±∆˜5£¨”√”⁄…Ë÷√»¡Î∏±Í÷æŒ≥∫Õä 682    † †   {
†683  (1       TH0=0xf∂;ç
 6x4   1 !    ` TL0=1x!c;  685  $1  "     ms++;
 686  †1     0  if(ms%≤005=0)
 687   3        z
 68x   2$     $   s1=!s19J069)(( 2        yä 690   1 00   $ ef(ms|3)8)
 91` "±0       k]
 692   3  $  0$   ms=0;-
!693   2  †   b }J 694 ""3        prlc8)?
 6954  q    ` }ÖJ"96   ! $     697 !0       vnhd Serial(void) intersupt 4ä 698¯ (  (    {
 v99"  1       a„vAtic chCr Bunf[4],I;
!700∞  1"       an(RI) 7 1`  1 d  †   { 70r   2   a   "  RIΩ0;
†703) a2 ,  `  !  buff[i] = SBUF;
 744   2  †$ *(  (È*+; w05   6"`(       if(Buff[i] == #')
 706$  3       $  {
 70'  `3"" "         708 ! 3     0      ¬uff[i] = '\0Á
 709 $ 3  0         id(str3vÚ)"Ôn#"lBwff) !Ω NULL- 714!  3  `      "0 {J 1=   4  0   !    $  TI = 1;ä 712   t†(            printF("HÂllo WoRld")? 713  $4 ( 0 0    †" 0whmÏE(!TI);
 7!4   4        ( 0 † UC = 0;M 715   4 !     `    }
$716 0 3      ,§    i=8;
0717   3       †  ]
†718`  0$$     !( 
 719"  2 † b    }
 w20$  1    2 }
	
MODEÃE†INFORMATION   STATIG NVERLAYAKLE   CODE […JE    ∞ 0$=   2137  ( ----
   CONCTANT SIZE    =   ! 70  ! ≠---
   DA‘A SIE   $(! =  !--!- $ $----
   PDATQ SIZE       } $"-m--    =--)
   DATQ RIZE `    ! =   Ä"8≤       3
  `IDATA SIZE      (= `"-/--   -,-
  !BI\ SIZE         =      4    ---≠
EŒD œF†]ODUHE INFORÕATION.


C51 √OMRILATION CMMPLETL  0 ◊ATŒING)S),  0`ERRKRS)
